{"version":3,"file":"js/857.8255a6e8.js","mappings":"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","sources":["webpack://giligili/./src/views/PostVideo.vue","webpack://giligili/src/views/PostVideo.vue","webpack://giligili/./src/views/PostVideo.vue?6ba4","webpack://giligili/./src/views/PostVideo.vue?e5a0"],"sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',[_c('h1',{staticStyle:{\"text-align\":\"center\"}},[_vm._v(\"快乐因分享而更快乐\")]),_c('el-form',{ref:\"form\",attrs:{\"model\":_vm.form,\"label-width\":\"80px\",\"status-icon\":\"\",\"rules\":_vm.rules,\"hide-required-asterisk\":\"\"}},[_c('el-form-item',{attrs:{\"label\":\"标题\",\"prop\":\"title\"}},[_c('el-input',{attrs:{\"autocomplete\":\"off\"},model:{value:(_vm.form.title),callback:function ($$v) {_vm.$set(_vm.form, \"title\", $$v)},expression:\"form.title\"}})],1),_c('el-form-item',{attrs:{\"label\":\"简介\",\"prop\":\"info\"}},[_c('el-input',{attrs:{\"type\":\"textarea\",\"autocomplete\":\"off\"},model:{value:(_vm.form.info),callback:function ($$v) {_vm.$set(_vm.form, \"info\", $$v)},expression:\"form.info\"}})],1),_c('el-form-item',{attrs:{\"label\":\"封面\"}},[_c('el-upload',{attrs:{\"action\":\"\",\"http-request\":_vm.uploadCover,\"before-upload\":_vm.beforeUploadCover,\"on-exceed\":_vm.onExceed,\"on-remove\":_vm.onRemoveCover,\"before-remove\":_vm.beforeRemove,\"limit\":1,\"accept\":\".jpg,.jpeg,.png\"}},[_c('el-button',{attrs:{\"size\":\"mini\"}},[_vm._v(\"选择封面\")])],1)],1),_c('el-form-item',{attrs:{\"label\":\"视频\"}},[_c('el-upload',{attrs:{\"action\":\"\",\"http-request\":_vm.uploadVideo,\"before-upload\":_vm.beforeUploadVideo,\"on-exceed\":_vm.onExceed,\"on-remove\":_vm.onRemoveVideo,\"before-remove\":_vm.beforeRemove,\"limit\":1,\"accept\":\".mp4\"}},[_c('el-button',{attrs:{\"size\":\"mini\"}},[_vm._v(\"选择视频\")])],1)],1),_c('el-form-item',[(_vm.showProgress)?_c('span',{staticStyle:{\"color\":\"#606266\"}},[_vm._v(\"上传中，过程可能较慢，请勿关闭页面或操作被上传的文件; 在token刷新时可能会造成进度条不动，此时属于正常现象\")]):_vm._e(),(_vm.showProgress)?_c('el-progress',{attrs:{\"percentage\":_vm.progressPercentage}}):_vm._e(),_c('el-button',{attrs:{\"id\":\"button\",\"type\":\"primary\"},on:{\"click\":_vm.postvideo}},[_vm._v(\"投稿\"),_c('i',{staticClass:\"el-icon-upload el-icon--right\"})])],1)],1)],1)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div>\n    <h1 style=\"text-align:center\">快乐因分享而更快乐</h1>\n    <el-form ref=\"form\" :model=\"form\" label-width=\"80px\" status-icon :rules=\"rules\" hide-required-asterisk>\n      <el-form-item label=\"标题\" prop=\"title\">\n        <el-input v-model=\"form.title\" autocomplete=\"off\"></el-input>\n      </el-form-item>\n      <el-form-item label=\"简介\" prop=\"info\">\n        <el-input type=\"textarea\" v-model=\"form.info\" autocomplete=\"off\"></el-input>\n      </el-form-item>\n      <el-form-item label=\"封面\">\n        <el-upload action=\"\" :http-request=\"uploadCover\" :before-upload=\"beforeUploadCover\" :on-exceed=\"onExceed\"\n          :on-remove=\"onRemoveCover\" :before-remove=\"beforeRemove\" :limit=\"1\" accept=\".jpg,.jpeg,.png\">\n          <el-button size=\"mini\">选择封面</el-button>\n        </el-upload>\n      </el-form-item>\n      <el-form-item label=\"视频\">\n        <el-upload action=\"\" :http-request=\"uploadVideo\" :before-upload=\"beforeUploadVideo\" :on-exceed=\"onExceed\"\n          :on-remove=\"onRemoveVideo\" :before-remove=\"beforeRemove\" :limit=\"1\" accept=\".mp4\">\n          <el-button size=\"mini\">选择视频</el-button>\n        </el-upload>\n      </el-form-item>\n      <el-form-item>\n        <span v-if=\"showProgress\" style=\"color: #606266;\">上传中，过程可能较慢，请勿关闭页面或操作被上传的文件;\n          在token刷新时可能会造成进度条不动，此时属于正常现象</span>\n        <el-progress v-if=\"showProgress\" :percentage=\"progressPercentage\"></el-progress>\n        <el-button id=\"button\" type=\"primary\" @click=\"postvideo\">投稿<i class=\"el-icon-upload el-icon--right\"></i>\n        </el-button>\n      </el-form-item>\n    </el-form>\n  </div>\n</template>\n\n<script>\nimport * as API from '@/api/video'\n\nexport default {\n  data() {\n    return {\n      form: {\n        title: '',\n        info: '',\n        cover: '',\n        video: '',\n      },\n      progressPercentage: 0,\n      showProgress: false,\n      rules: {\n        title: [\n          { required: true, message: '请输入标题', trigger: 'blur' },\n          { min: 2, max: 30, message: '长度在 2 到 30 个字符', trigger: 'blur' }\n        ],\n        info: [\n          { max: 255, message: '长度需小于等于255个字符', trigger: 'blur' }\n        ],\n      }\n    }\n  },\n  methods: {\n    postvideo() {\n      this.$refs['form'].validate((valid) => {\n        if (!valid) {\n          this.$notify.error({\n            title: '投稿失败',\n            message: '填入信息有误',\n            showClose: false\n          });\n        } else {\n          if (this.form.cover === \"\") {\n            this.$notify.error({\n              title: '投稿失败',\n              message: '未上传封面',\n              showClose: false\n            });\n            return\n          } else if (this.form.video === \"\") {\n            this.$notify.error({\n              title: '投稿失败',\n              message: '未上传视频',\n              showClose: false\n            });\n            return\n          }\n          let form = new FormData()\n          form.append(\"title\", this.form.title)\n          form.append(\"info\", this.form.info)\n          form.append(\"cover\", this.form.cover)\n          form.append(\"video\", this.form.video)\n          let button = document.getElementById(\"button\")\n          button.disabled = true\n          let preInner = button.innerHTML\n          button.innerHTML = \"投稿中...\"\n          this.$message('上传中，过程可能较慢，请勿关闭页面或操作被上传的文件');\n          let _this = this\n          _this.showProgress = true\n          API.postVideo(form, function (e) {\n            _this.progressPercentage = parseInt(e.loaded / e.total * 100)\n          }).then((res) => {\n            if (res.code === 0) {\n              this.$notify({\n                title: '投稿成功',\n                message: `您投稿的视频id为${res.data.id}`,\n                type: 'success',\n                showClose: false\n              });\n              this.$router.push('/video/' + res.data.id)\n            } else {\n              this.$notify.error({\n                title: '投稿失败',\n                message: res.msg,\n                showClose: false\n              });\n              button.disabled = false\n              button.innerHTML = preInner\n              this.showProgress = false\n              this.progressPercentage = 0\n            }\n          }).catch((error) => {\n            this.$notify.error({\n              title: '投稿失败',\n              message: error,\n              showClose: false\n            });\n            button.disabled = false\n            button.innerHTML = preInner\n            this.showProgress = false\n            this.progressPercentage = 0\n          });\n        }\n      });\n    },\n    onExceed() {\n      this.$message.warning(\"文件只能为1个\")\n    },\n    uploadCover(option) {\n      this.form.cover = option.file\n    },\n    beforeUploadCover(file) {\n      if (file.size / 1024 / 1024 > 2) {\n        this.$message.error('封面大小不能超过2MB');\n        return false\n      }\n      return true\n    },\n    onRemoveCover(file) {\n      if (file.size / 1024 / 1024 <= 2) { //封面大小超过2MB时会自动触发移除钩子\n        this.form.cover = \"\"\n      }\n    },\n    uploadVideo(option) {\n      this.form.video = option.file\n    },\n    beforeUploadVideo(file) {\n      if (file.size / 1024 / 1024 > 1024) {\n        this.$message.error('视频大小不能超过1GB');\n        return false\n      }\n      return true\n    },\n    onRemoveVideo(file) {\n      if (file.size / 1024 / 1024 <= 100) { //视频大小超过1GB时会自动触发移除钩子\n        this.form.video = \"\"\n      }\n    },\n    beforeRemove() {\n      if (this.showProgress) {\n        this.$message({\n          message: '上传时禁止移除文件',\n          type: 'warning'\n        });\n        return false\n      }\n      return true\n    },\n  },\n}\n</script>\n","import mod from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./PostVideo.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./PostVideo.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./PostVideo.vue?vue&type=template&id=2cbb7e32&\"\nimport script from \"./PostVideo.vue?vue&type=script&lang=js&\"\nexport * from \"./PostVideo.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"names":["render","_vm","this","_c","_self","staticStyle","_v","ref","attrs","form","rules","model","value","title","callback","$$v","$set","expression","info","uploadCover","beforeUploadCover","onExceed","onRemoveCover","beforeRemove","uploadVideo","beforeUploadVideo","onRemoveVideo","showProgress","_e","progressPercentage","on","postvideo","staticClass","staticRenderFns","data","cover","video","required","message","trigger","min","max","methods","showClose","button","_this","API","type","component"],"sourceRoot":""}