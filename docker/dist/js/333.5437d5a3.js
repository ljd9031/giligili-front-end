"use strict";(self["webpackChunkgiligili"]=self["webpackChunkgiligili"]||[]).push([[333],{6333:function(e,t,s){s.r(t),s.d(t,{default:function(){return d}});var a=function(){var e=this,t=e._self._c;return t("el-form",{ref:"form",staticStyle:{"margin-top":"30px"},attrs:{model:e.user,"label-width":"80px"}},[t("el-form-item",{attrs:{label:"头像"}},[t("el-upload",{ref:"avatar",attrs:{action:"","http-request":e.uploadAvatar,"before-upload":e.beforeUploadAvatar,"on-exceed":e.onExceed,limit:1,accept:".jpg,.jpeg,.png"}},[t("el-avatar",{attrs:{src:e.user.avatar}},[t("el-avatar",{attrs:{icon:"el-icon-user-solid"}})],1)],1)],1),t("el-form-item",{attrs:{label:"用户ID"}},[t("el-input",{staticClass:"inpWid",attrs:{readonly:""},model:{value:e.user.id,callback:function(t){e.$set(e.user,"id",t)},expression:"user.id"}})],1),t("el-form-item",{attrs:{label:"注册日期"}},[t("el-input",{staticClass:"inpWid",attrs:{readonly:""},model:{value:e.user.created_at,callback:function(t){e.$set(e.user,"created_at",t)},expression:"user.created_at"}})],1),t("el-form-item",{attrs:{label:"昵称"}},[t("el-input",{staticClass:"inpWid",attrs:{readonly:""},model:{value:e.user.nickname,callback:function(t){e.$set(e.user,"nickname",t)},expression:"user.nickname"}}),t("el-button",{attrs:{type:"success"},on:{click:e.updateNickname}},[e._v("修改")])],1),t("el-form-item",{attrs:{label:"签名"}},[t("el-input",{staticClass:"inpWid",attrs:{readonly:""},model:{value:e.user.signature,callback:function(t){e.$set(e.user,"signature",t)},expression:"user.signature"}}),t("el-button",{attrs:{type:"success"},on:{click:e.updateSignature}},[e._v("修改")])],1),t("el-form-item",{attrs:{label:"IP属地"}},[t("el-input",{staticClass:"inpWid",attrs:{readonly:""},model:{value:e.user.ip_location,callback:function(t){e.$set(e.user,"ip_location",t)},expression:"user.ip_location"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"success"},on:{click:e.updatePassword}},[e._v("修改密码")]),t("el-button",{attrs:{type:"danger"},on:{click:e.logout}},[e._v("登出")])],1)],1)},r=[],n=s(2900),i=s(6369),o={data(){return{user:{}}},methods:{load(){n.me().then((e=>{0===e.code?(this.user=e.data,this.user.created_at=new Date(1e3*this.user.created_at).toLocaleString()):this.$notify.error({title:"获取用户信息失败",message:e.msg,showClose:!1})})).catch((e=>{this.$notify.error({title:"获取用户信息失败",message:e,showClose:!1})}))},logout(){i.uc(),this.$notify({title:"登出成功",type:"success",showClose:!1})},updateNickname(){this.$prompt("请输入新昵称","修改昵称",{confirmButtonText:"确定",cancelButtonText:"取消"}).then((({value:e})=>{e.length<2||e.length>30?this.$message.error("昵称的长度需在 2 到 30 个字符之间"):e===this.user.nickname?this.$message.error("新昵称与原昵称相同"):n.Gz({new_nickname:e}).then((e=>{0===e.code?(this.user.nickname=e.data.nickname,this.$message({type:"success",message:"修改成功"})):this.$message.error(e.msg)})).catch((e=>{this.$message.error(e)}))})).catch((()=>{}))},updateSignature(){this.$prompt("请输入新签名","修改签名",{confirmButtonText:"确定",cancelButtonText:"取消"}).then((({value:e})=>{e.length>50?this.$message.error("签名的长度需小于 50 个字符"):e===this.user.signature?this.$message.error("新签名与原签名相同"):n.tb({new_signature:e}).then((e=>{0===e.code?(this.user.signature=e.data.signature,this.$message({type:"success",message:"修改成功"})):this.$message.error(e.msg)})).catch((e=>{this.$message.error(e)}))})).catch((()=>{}))},updatePassword(){const e=this.$createElement;this.$msgbox({title:"修改密码",message:e("div",null,[e("span",null,"请输入新密码"),e("h1"),e("input",{attrs:{class:"el-input__inner",id:"password",type:"password"}}),e("h1"),e("span",null,"请输入新确认密码"),e("h1"),e("input",{attrs:{class:"el-input__inner",id:"password_confirm",type:"password"}})]),showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消",beforeClose:(e,t,s)=>{"confirm"!==e&&(document.getElementById("password").value="",document.getElementById("password_confirm").value=""),s()}}).then((()=>{let e=document.getElementById("password"),t=document.getElementById("password_confirm");e.value.length<8||e.value.length>40||t.value.length<8||t.value.length>40?this.$message.error("密码的长度需在 8 到 40 个字符之间"):e.value!==t.value?this.$message.error("两次密码输入不一致"):n.gQ({new_password:e.value,new_password_confirm:t.value}).then((e=>{0===e.code?this.$message({type:"success",message:"修改成功"}):this.$message.error(e.msg)})).catch((e=>{this.$message.error(e)})),e.value="",t.value=""})).catch((()=>{}))},onExceed(){this.$message.warning("文件只能为1个")},uploadAvatar(e){let t=new FormData;t.append("avatar",e.file),n.gg(t).then((e=>{0===e.code?(this.user.avatar=e.data.avatar,this.$message({type:"success",message:"上传成功"})):this.$message.error(e.msg)})).catch((e=>{this.$message.error(e)})),this.$refs["avatar"].clearFiles()},beforeUploadAvatar(e){return!(e.size/1024/1024>2)||(this.$message.error("头像大小不能超过2MB"),!1)}},beforeMount(){this.load()}},l=o,u=s(1001),c=(0,u.Z)(l,a,r,!1,null,null,null),d=c.exports},2900:function(e,t,s){s.d(t,{Gz:function(){return l},PR:function(){return o},gQ:function(){return c},gg:function(){return d},me:function(){return i},tb:function(){return u},x4:function(){return n},z2:function(){return r}});var a=s(196);const r=e=>a.Z.post("/api/v1/register",e).then((e=>e.data)),n=e=>a.Z.post("/api/v1/login",e).then((e=>e.data)),i=()=>a.Z.get("/api/v1/me").then((e=>e.data)),o=e=>a.Z.get(`/api/v1/user/${e}`).then((e=>e.data)),l=e=>a.Z.put("/api/v1/user/nickname",e).then((e=>e.data)),u=e=>a.Z.put("/api/v1/user/signature",e).then((e=>e.data)),c=e=>a.Z.put("/api/v1/user/password",e).then((e=>e.data)),d=e=>a.Z.post("/api/v1/user/avatar",e).then((e=>e.data))}}]);
//# sourceMappingURL=333.5437d5a3.js.map